[gd_scene load_steps=43 format=3 uid="uid://cedveobf44rv7"]

[ext_resource type="PackedScene" uid="uid://c1qx1q2ylej3m" path="res://Scenes/Objects/Player/player.tscn" id="1_ifevs"]
[ext_resource type="Script" path="res://Scripts/GameEntities/game_entities.gd" id="1_rh6ip"]
[ext_resource type="PackedScene" uid="uid://chhsxxwlq64bs" path="res://Scenes/Objects/Enemy/enemy.tscn" id="2_xe5fl"]
[ext_resource type="PackedScene" uid="uid://dt2kf02le6ak" path="res://Scenes/Objects/Danmaku/danmaku.tscn" id="3_7x6lx"]
[ext_resource type="TileSet" uid="uid://bhxmfe0msahhf" path="res://Resources/Tileset/tileset.tres" id="3_xmtiq"]
[ext_resource type="PackedScene" uid="uid://cyb7mfpr6ll6d" path="res://Scenes/Objects/PItem/p_item.tscn" id="4_4s0vl"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/BTRoot.gd" id="4_pc63g"]
[ext_resource type="Script" path="res://Scripts/GameState/game_state.gd" id="5_05ol6"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Composite/BTSelector.gd" id="5_jd2hr"]
[ext_resource type="PackedScene" uid="uid://c67qavicmv4cu" path="res://Scenes/Objects/Chest/chest.tscn" id="6_0xhgl"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsProcess.gd" id="6_0xt3d"]
[ext_resource type="Texture2D" uid="uid://brycb6r6ppqcb" path="res://Assets/Sprites/Visual effect/dragonjewel.png" id="7_3fwf5"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Composite/BTSequence.gd" id="7_y3uvg"]
[ext_resource type="PackedScene" uid="uid://d2sasf8vv0m84" path="res://Scenes/Objects/Door/door.tscn" id="8_78w64"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsDesignatedToAlarm.gd" id="8_sd4yw"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsRunningToAlarm.gd" id="9_asfp0"]
[ext_resource type="PackedScene" uid="uid://ctluf3yg2l1l0" path="res://Scenes/Objects/Alarm/alarm.tscn" id="9_grg02"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/SetActorMoveSpeed.gd" id="10_tod2d"]
[ext_resource type="PackedScene" uid="uid://dxi0fnvj5y78i" path="res://Scenes/Overlay/HUD.tscn" id="11_8wmpp"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/MoveToAlarm.gd" id="11_x563e"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Decorators/BTSuccess.gd" id="12_cjecm"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsNearAlarm.gd" id="13_ouddt"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/ActivateAlarm.gd" id="14_k0wh5"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/RemoveAlarmDesignation.gd" id="15_trf2x"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/SetRunningToAlarm.gd" id="16_bg7o8"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/AddToBBoard.gd" id="17_cbfhr"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/SetActorAttackAnim.gd" id="18_i3k7w"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/CheckViewbox.gd" id="19_wpyqo"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/RaycastCheck.gd" id="20_jin6t"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Decorators/BTInverter.gd" id="21_e1djd"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/SetState.gd" id="22_s0gt3"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/MoveToTarget.gd" id="23_pl6gm"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Leaves/BTActionBlackboardSet.gd" id="24_s0gir"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsAttackCooldown.gd" id="25_qdx1p"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/Attack.gd" id="26_g5rk0"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/SetActorAlertAnim.gd" id="27_5fr8n"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsHearingSounds.gd" id="28_0r36i"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/CheckTargetDist.gd" id="29_5v8qy"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/MoveToInvestigate.gd" id="30_hntcp"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/IsTurnCooldown.gd" id="31_27400"]
[ext_resource type="Script" path="res://Scripts/Enemy/BehaviorTree/TurnRandomly.gd" id="32_tc28s"]
[ext_resource type="Script" path="res://addons/yet_another_behavior_tree/src/Nodes/Leaves/BTActionWait.gd" id="33_udrxe"]

[node name="Main" type="Node2D"]

[node name="GameEntities" type="Node" parent="."]
script = ExtResource("1_rh6ip")

[node name="Player" parent="GameEntities" groups=["Player"] instance=ExtResource("1_ifevs")]
position = Vector2(308, 53)

[node name="Enemy" parent="GameEntities" node_paths=PackedStringArray("designated_alarm") instance=ExtResource("2_xe5fl")]
position = Vector2(-403, 128)
default_rotation = 0.0
designated_alarm = NodePath("../Alarm")

[node name="BehaviourTree" type="Node" parent="GameEntities/Enemy" node_paths=PackedStringArray("blackboard")]
script = ExtResource("4_pc63g")
actor_path = NodePath("..")
blackboard = NodePath("@Node@137535")

[node name="main" type="Node" parent="GameEntities/Enemy/BehaviourTree"]
script = ExtResource("5_jd2hr")

[node name="IsProcess" type="Node" parent="GameEntities/Enemy/BehaviourTree/main"]
script = ExtResource("6_0xt3d")

[node name="SetOffAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main"]
script = ExtResource("7_y3uvg")

[node name="IsDesignatedToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm"]
script = ExtResource("8_sd4yw")

[node name="IsRunningToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm"]
script = ExtResource("9_asfp0")

[node name="SetActorMoveSpeed" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm"]
script = ExtResource("10_tod2d")
is_run_speed = true

[node name="MoveToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm"]
script = ExtResource("11_x563e")

[node name="BTSuccess" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm"]
script = ExtResource("12_cjecm")

[node name="BTSequence" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm/BTSuccess"]
script = ExtResource("7_y3uvg")

[node name="IsNearAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm/BTSuccess/BTSequence"]
script = ExtResource("13_ouddt")

[node name="ActivateAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm/BTSuccess/BTSequence"]
script = ExtResource("14_k0wh5")

[node name="RemoveAlarmDesignation" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm/BTSuccess/BTSequence"]
script = ExtResource("15_trf2x")

[node name="SetRunningToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/SetOffAlarm/BTSuccess/BTSequence"]
script = ExtResource("16_bg7o8")

[node name="Attack" type="Node" parent="GameEntities/Enemy/BehaviourTree/main"]
script = ExtResource("7_y3uvg")

[node name="IsAttack" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack"]
script = ExtResource("7_y3uvg")

[node name="AddToBBoard" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack"]
script = ExtResource("17_cbfhr")
key = "player_in_view_box"

[node name="SetActorAttackAnim" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack"]
script = ExtResource("18_i3k7w")

[node name="CheckViewbox" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack"]
script = ExtResource("19_wpyqo")

[node name="RaycastCheck" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack"]
script = ExtResource("20_jin6t")

[node name="BTSelector" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack"]
script = ExtResource("5_jd2hr")

[node name="BTInverter" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack/BTSelector"]
script = ExtResource("21_e1djd")

[node name="IsDesignatedToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack/BTSelector/BTInverter"]
script = ExtResource("8_sd4yw")

[node name="SetRunningToAlarm" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/IsAttack/BTSelector"]
script = ExtResource("16_bg7o8")
running_to_alarm = true

[node name="SetState" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack"]
script = ExtResource("22_s0gt3")

[node name="MoveAndAttack" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack"]
script = ExtResource("7_y3uvg")

[node name="Move" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack"]
script = ExtResource("7_y3uvg")

[node name="SetActorMoveSpeed" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Move"]
script = ExtResource("10_tod2d")
is_run_speed = true

[node name="SetActorAttackAnim" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Move"]
script = ExtResource("18_i3k7w")
is_attacking = true

[node name="MoveToTarget" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Move"]
script = ExtResource("23_pl6gm")

[node name="Attack" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack"]
script = ExtResource("7_y3uvg")

[node name="IsPlayerInRange" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Attack"]
script = ExtResource("24_s0gir")
blackboard_key = "player_in_range"
expression = "actor.player_in_range"
can_overwrite_value = true

[node name="IsAttackCooldown" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Attack"]
script = ExtResource("25_qdx1p")

[node name="Attack" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Attack/MoveAndAttack/Attack"]
script = ExtResource("26_g5rk0")

[node name="Alerted" type="Node" parent="GameEntities/Enemy/BehaviourTree/main"]
script = ExtResource("7_y3uvg")

[node name="SetActorAlertAnimFalse" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted"]
script = ExtResource("27_5fr8n")

[node name="IsHearingSounds" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted"]
script = ExtResource("28_0r36i")

[node name="SetActorAlertAnimTrue" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted"]
script = ExtResource("27_5fr8n")
is_moving = true

[node name="InvestigateSound" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted"]
script = ExtResource("7_y3uvg")

[node name="SetActorMoveSpeed" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted/InvestigateSound"]
script = ExtResource("10_tod2d")

[node name="CheckTargetDist" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted/InvestigateSound"]
script = ExtResource("29_5v8qy")

[node name="MoveToInvestigate" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/Alerted/InvestigateSound"]
script = ExtResource("30_hntcp")

[node name="BTSelector" type="Node" parent="GameEntities/Enemy/BehaviourTree/main"]
script = ExtResource("5_jd2hr")

[node name="BTSequence" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/BTSelector"]
script = ExtResource("7_y3uvg")

[node name="IsTurnCooldown" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/BTSelector/BTSequence"]
script = ExtResource("31_27400")

[node name="TurnRandomly" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/BTSelector/BTSequence"]
script = ExtResource("32_tc28s")

[node name="Idle" type="Node" parent="GameEntities/Enemy/BehaviourTree/main/BTSelector"]
script = ExtResource("33_udrxe")
wait_time_ms = 3

[node name="Enemy2" parent="GameEntities" node_paths=PackedStringArray("designated_alarm") instance=ExtResource("2_xe5fl")]
position = Vector2(32, -102)
default_rotation = 0.0
designated_alarm = NodePath("../Alarm")

[node name="Danmaku" parent="GameEntities" instance=ExtResource("3_7x6lx")]
position = Vector2(-54, -433)
damage = 1

[node name="PItem" parent="GameEntities" instance=ExtResource("4_4s0vl")]

[node name="Chest" parent="GameEntities" instance=ExtResource("6_0xhgl")]
position = Vector2(237, 187)
is_true_chest = true
treasure_sprite = ExtResource("7_3fwf5")

[node name="Door" parent="GameEntities" instance=ExtResource("8_78w64")]
position = Vector2(69, 208)
rotation = -1.67552
scale = Vector2(2.5, 1)

[node name="Alarm" parent="GameEntities" instance=ExtResource("9_grg02")]
position = Vector2(-381, -187)

[node name="GameState" type="Node" parent="."]
script = ExtResource("5_05ol6")

[node name="Utils" type="Node" parent="."]

[node name="UI" type="CanvasLayer" parent="."]

[node name="HUD" parent="UI" instance=ExtResource("11_8wmpp")]

[node name="TileMap" type="TileMap" parent="."]
scale = Vector2(4, 4)
tile_set = ExtResource("3_xmtiq")
format = 2
layer_0/name = "floor"
layer_0/tile_data = PackedInt32Array(-131077, 65538, 0, -65541, 65538, 1, -5, 65538, 1, -4, 131074, 1, -3, 131074, 1, 65533, 131074, 2, 65534, 196610, 2, -2, 196610, 1, -65538, 196610, 1, -65540, 131074, 1, -131076, 131074, 0, -131075, 131074, 0, -65539, 131074, 1, 65532, 131074, 2, 65531, 65538, 2, -131074, 196610, 0, 196601, 2, 0, 196602, 2, 0, 196603, 2, 0, 196604, 2, 0, 196605, 2, 0, 196606, 2, 0, 131070, 2, 0, 131069, 2, 0, 131068, 2, 0, 131067, 2, 0, 131066, 2, 0, 131065, 2, 0, 65529, 2, 0, -7, 2, 0, -6, 2, 0, 65530, 2, 0)
layer_1/name = "static_objs"
layer_1/enabled = true
layer_1/modulate = Color(1, 1, 1, 1)
layer_1/y_sort_enabled = false
layer_1/y_sort_origin = 0
layer_1/z_index = 0
layer_1/tile_data = PackedInt32Array(196613, 262146, 65536, 131077, 327682, 196608, 65541, 327682, 196608, 5, 327682, 196608, -65531, 327682, 196608, -131067, 327682, 196608, -196603, 327682, 196608, -262139, 262146, 131072, 196612, 327682, 65536, 131076, 458754, 0, 65540, 458754, 0, 4, 458754, 0, -65532, 458754, 0, -131068, 458754, 0, -196604, 458754, 0, -262140, 327682, 0, 196611, 327682, 65536, 131075, 458754, 0, 65539, 458754, 0, 3, 393218, 3, -65533, 393218, 3, -131069, 393218, 3, -196605, 458754, 0, -262141, 327682, 0, 196610, 327682, 65536, -131070, 393218, 4, -196606, 458754, 0, -262142, 327682, 0, 196609, 327682, 65536, -65535, 458754, 0, -131071, 458754, 0, -196607, 458754, 0, -262143, 327682, 0, 196608, 327682, 65536, 131072, 458754, 0, 65536, 458754, 0, 0, 458754, 0, -65536, 458754, 0, -131072, 458754, 0, -196608, 458754, 0, -262144, 327682, 0, 262143, 327682, 65536, 196607, 458754, 0, 131071, 458754, 0, 65535, 393218, 0, -1, 327682, 131072, -65537, 327682, 131072, -131073, 327682, 131072, -196609, 262146, 0, 262142, 327682, 65536, 196606, 458754, 0, 131070, 458754, 0, 65534, 327682, 0, -2, 262146, 1, -65538, 262146, 1, -131074, 262146, 1, -196610, 262146, 1, 262141, 327682, 65536, 196605, 458754, 0, 131069, 458754, 0, 65533, 393218, 65536, -3, 327682, 196608, -65539, 327682, 196608, -131075, 327682, 196608, -196611, 262146, 131072, 262140, 327682, 65536, 196604, 458754, 0, 131068, 458754, 0, 65532, 458754, 0, -4, 458754, 0, -65540, 458754, 0, -131076, 458754, 0, -196612, 327682, 0, 262139, 327682, 65536, 196603, 458754, 0, 131067, 458754, 0, 65531, 458754, 0, -5, 458754, 0, -65541, 458754, 0, -131077, 458754, 0, -196613, 327682, 0, 262138, 327682, 65536, 196602, 458754, 0, 131066, 458754, 0, 65530, 458754, 0, -6, 458754, 0, -65542, 458754, 0, -131078, 458754, 0, -196614, 327682, 0, 262137, 327682, 65536, 196601, 458754, 0, 131065, 458754, 0, 65529, 458754, 0, -7, 458754, 0, -65543, 458754, 0, -131079, 458754, 0, -196615, 327682, 0, 262136, 262146, 196608, 196600, 327682, 131072, 131064, 327682, 131072, 65528, 327682, 131072, -8, 327682, 131072, -65544, 327682, 131072, -131080, 327682, 131072, -196616, 262146, 0, 2, 327682, 3, -65534, 393218, 3, 65537, 458754, 0, 131073, 458754, 0, 131074, 458754, 0, 65538, 458754, 0, 1, 458754, 0)

[connection signal="stage_lose" from="GameState" to="GameState" method="set_lose"]
[connection signal="stage_won" from="GameState" to="GameState" method="set_won"]
